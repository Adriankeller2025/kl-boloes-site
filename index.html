<!-- KL Bolões Lotinha - Site Profissional Integrado ao Google Sheets -->
<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>💜 KL Bolões Lotinha 💜</title>
  <style>
    /* (CSS copiado da versão anterior com layout moderno, neon e responsivo) */
  </style>
</head>
<body>
  <header>
    <h1>💜 KL Bolões Lotinha 💜</h1>
    <p>Reserve sua cota e boa sorte! 🍀</p>
  </header>

  <form id="bolaoForm">
    <label for="nome">Seu nome completo:</label>
    <input type="text" id="nome" name="nome" placeholder="Ex: Adriano Keller" required minlength="3" />

    <label for="cotas">Cotas inteiras (R$42,00 cada):</label>
    <input type="number" id="cotas" name="cotas" min="0" value="0" required />

    <label for="meiacota">Meias cotas (R$21,00 cada):</label>
    <input type="number" id="meiacota" name="meiacota" min="0" value="0" required />

    <button type="submit">Reservar minha Cota 🎟️</button>
  </form>

  <div class="info-box">
    <strong>💜 LOTINHA 20 DZ 💜</strong>
    <p>💰 Cota: <code>R$42,00</code> inteira ou <code>R$21,00</code> meia</p>
    <p>📅 Sorteio: Quarta e Sábado</p>
    <p>🚀 Confirmamos via WhatsApp após preenchimento</p>
    <a href="https://wa.me/553499356819" target="_blank">Falar com o responsável</a>
  </div>

  <script>
    document.getElementById("bolaoForm").addEventListener("submit", async function (event) {
      event.preventDefault();

      const nome = document.getElementById("nome").value.trim();
      const cotas = document.getElementById("cotas").value.trim();
      const meiacota = document.getElementById("meiacota").value.trim();

      const url = "https://script.google.com/macros/s/AKfycbwTm2PnI4nrrJTlZqD40d3Bs12rtdRewu1NE4Pl73pLP1H7ulNxhBFWp1BEmvYXyf2Z/exec";

      try {
        const res = await fetch(url, {
          method: "POST",
          headers: { "Content-Type": "application/x-www-form-urlencoded" },
          body: `nome=${encodeURIComponent(nome)}&cotas=${encodeURIComponent(cotas)}&meiacota=${encodeURIComponent(meiacota)}`
        });

        const result = await res.json();

        if (result.result === "ok") {
          alert("Cota reservada com sucesso! Entraremos em contato pelo WhatsApp.");
          document.getElementById("bolaoForm").reset();
        } else {
          alert("Erro ao enviar: " + result.message);
        }
      } catch (error) {
        alert("Erro ao conectar com o servidor.");
        console.error(error);
      }
    });
  </script>
</body>
</html>

/* Google Apps Script para planilha "listakl" */

function doPost(e) {
  try {
    const ss = SpreadsheetApp.getActiveSpreadsheet();
    const sheet = ss.getSheetByName("listakl");
    if (!sheet) return ContentService.createTextOutput("Erro: Aba 'listakl' não encontrada.");

    const nome = e.parameter.nome || "";
    const cotas = e.parameter.cotas || "0";
    const meiacota = e.parameter.meiacota || "0";

    const cotasInt = parseInt(cotas, 10) || 0;
    const meiacotaInt = parseInt(meiacota, 10) || 0;

    sheet.appendRow([new Date(), nome.trim(), cotasInt, meiacotaInt]);

    return ContentService.createTextOutput(JSON.stringify({ result: "ok" }))
      .setMimeType(ContentService.MimeType.JSON)
      .setHeader("Access-Control-Allow-Origin", "*");
  } catch (err) {
    return ContentService.createTextOutput(JSON.stringify({ result: "error", message: err.message }))
      .setMimeType(ContentService.MimeType.JSON)
      .setHeader("Access-Control-Allow-Origin", "*");
  }
}

function doGet(e) {
  return HtmlService.createHtmlOutput("Acesso não permitido");
}
